<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low-Carbon Facade Materials Research Mind Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .title-section {
            text-align: center;
            margin-bottom: 15px;
        }
        
        h1 {
            color: #2d3748;
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #718096;
            font-size: 0.9em;
        }
        
        .controls-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .search-container {
            position: relative;
            flex: 0 1 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }
        
        .clear-search {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            background: #e2e8f0;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #4a5568;
        }
        
        .clear-search:hover {
            background: #cbd5e0;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .zoom-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .zoom-level {
            padding: 5px 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 15px;
            font-size: 12px;
            min-width: 50px;
            text-align: center;
        }
        
        .mindmap-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: white;
        }
        
        svg {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        svg.grabbing {
            cursor: grabbing;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node.highlighted {
            filter: none !important;
            opacity: 1 !important;
        }
        
        .node.dimmed {
            opacity: 0.3;
            filter: grayscale(80%);
        }
        
        .node-circle {
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .node:hover .node-circle {
            filter: brightness(1.1) drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        
        .node-text {
            pointer-events: none;
            user-select: none;
            fill: #2d3748;
        }
        
        .center-node .node-text {
            fill: white;
            font-weight: bold;
        }
        
        .link {
            fill: none;
            stroke-opacity: 0.3;
            transition: all 0.3s ease;
        }
        
        .link.highlighted {
            stroke-opacity: 0.8 !important;
            stroke-width: 3 !important;
        }
        
        .link.dimmed {
            stroke-opacity: 0.1;
        }
        
        .tooltip {
            position: absolute;
            padding: 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 350px;
            z-index: 2000;
            line-height: 1.4;
        }
        
        .tooltip strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .search-results {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none;
            max-width: 300px;
        }
        
        .search-results.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .controls-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-container {
                width: 100%;
                flex: 1;
            }
            
            .button-group {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            button {
                font-size: 12px;
                padding: 8px 16px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .legend {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title-section">
                <h1>üè¢ Low-Carbon Facade Materials Research</h1>
                <div class="subtitle">Zero Carbon Target 2040 - Interactive Mind Map</div>
            </div>
            
            <div class="controls-section">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search materials, concepts, or metrics..." id="searchInput">
                    <button class="clear-search" id="clearSearch">√ó</button>
                    <span class="search-icon">üîç</span>
                </div>
                
                <div class="button-group">
                    <button onclick="expandAll()">üìÇ Expand All</button>
                    <button onclick="collapseAll()">üìÅ Collapse All</button>
                    <button onclick="resetView()">üéØ Reset View</button>
                </div>
                
                <div class="zoom-controls">
                    <button onclick="zoomIn()">‚ûï</button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button onclick="zoomOut()">‚ûñ</button>
                </div>
                
                <button onclick="exportData()">üíæ Export</button>
            </div>
        </div>
        
        <div class="mindmap-container">
            <svg id="mindmap"></svg>
            <div class="tooltip"></div>
            <div class="search-results" id="searchResults"></div>
            
            <div class="legend">
                <div class="legend-title">Categories</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6366f1;"></div>
                    <span>Core</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #10b981;"></div>
                    <span>Materials</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>Assessment</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ef4444;"></div>
                    <span>Innovation</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b5cf6;"></div>
                    <span>Supply Chain</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #06b6d4;"></div>
                    <span>Concrete/GRC</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mind map data structure with complete hierarchy
        const mindMapData = {
            name: "Low-Carbon\nFacade Materials",
            color: "#6366f1",
            description: "Central hub for zero carbon facade research targeting 2040",
            children: [
                {
                    name: "Carbon Assessment",
                    color: "#f59e0b",
                    description: "Tools and metrics for measuring facade carbon impact",
                    children: [
                        {
                            name: "Baseline Metrics",
                            children: [
                                { name: "Current kgCO2e/m¬≤", description: "Measure existing facade carbon" },
                                { name: "Lifecycle stages", description: "A1-A5, B, C, D analysis" },
                                { name: "EPD standards", description: "Environmental Product Declarations" }
                            ]
                        },
                        {
                            name: "Measurement Tools",
                            children: [
                                { name: "LCA methods", description: "Life Cycle Assessment" },
                                { name: "Carbon calculators", description: "Digital quantification tools" },
                                { name: "Verification", description: "Third-party validation" }
                            ]
                        }
                    ]
                },
                {
                    name: "Structural Materials",
                    color: "#10b981",
                    description: "Primary load-bearing facade materials",
                    children: [
                        {
                            name: "Aluminum",
                            children: [
                                { name: "Primary: 13-15 kg", description: "Virgin aluminum carbon" },
                                { name: "Recycled: 1-2 kg", description: "90% carbon reduction" },
                                { name: "75% recycled target", description: "Achievable content goals" },
                                { name: "Renewable smelting", description: "Hydro CIRCAL, REDUXA" }
                            ]
                        },
                        {
                            name: "Steel",
                            children: [
                                { name: "EAF steel", description: "Electric arc furnace" },
                                { name: "Recycled content", description: "Chain of custody tracking" },
                                { name: "Cold vs hot-rolled", description: "Process impacts" }
                            ]
                        },
                        {
                            name: "Concrete Precast",
                            color: "#06b6d4",
                            children: [
                                { name: "CEM I: 350-400", description: "Standard Portland cement" },
                                { name: "CEM II: 280-350", description: "6-20% SCM replacement" },
                                { name: "CEM III/A: 150-250", description: "36-65% GGBS content" },
                                { name: "CEM III/B: <150", description: "66-80% GGBS optimal" },
                                { name: "GGBS 50-70%", description: "Blast furnace slag" },
                                { name: "Hollow core", description: "30-50% reduction" },
                                { name: "CarbonCure", description: "CO2 mineralization" }
                            ]
                        },
                        {
                            name: "GRC Panels",
                            color: "#06b6d4",
                            children: [
                                { name: "Cement: 30-50%", description: "Lower than precast" },
                                { name: "Glass fiber: 3-5%", description: "AR vs E-glass" },
                                { name: "10-15mm thick", description: "vs 75-150mm precast" },
                                { name: "75% lighter", description: "Transport savings" },
                                { name: "SCM >40%", description: "Max cement replacement" }
                            ]
                        },
                        {
                            name: "Timber/Wood",
                            children: [
                                { name: "Carbon storage", description: "Biogenic carbon" },
                                { name: "CLT systems", description: "Cross-laminated timber" },
                                { name: "Glulam", description: "Glued laminated" },
                                { name: "Accoya", description: "Modified wood" }
                            ]
                        }
                    ]
                },
                {
                    name: "Cladding",
                    color: "#10b981",
                    description: "External facade finishing",
                    children: [
                        {
                            name: "Traditional",
                            children: [
                                { name: "Stone <500km", description: "Local sourcing" },
                                { name: "Brick", description: "Fired and unfired" },
                                { name: "Terracotta", description: "Rainscreen panels" }
                            ]
                        },
                        {
                            name: "Low-Carbon",
                            children: [
                                { name: "Fiber cement", description: "Composite panels" },
                                { name: "Recycled plastic", description: "Post-consumer waste" },
                                { name: "Reclaimed timber", description: "Salvaged wood" }
                            ]
                        },
                        {
                            name: "Bio-based",
                            children: [
                                { name: "Hemp panels", description: "Renewable fiber" },
                                { name: "Bamboo", description: "Engineered products" },
                                { name: "Mycelium", description: "Fungal materials" }
                            ]
                        }
                    ]
                },
                {
                    name: "Glazing",
                    color: "#10b981",
                    description: "Transparent facade components",
                    children: [
                        {
                            name: "Glass",
                            children: [
                                { name: "Double vs triple", description: "Unit comparison" },
                                { name: "Recycled cullet", description: "Post-consumer glass" },
                                { name: "Regional mfg", description: "Transport optimization" }
                            ]
                        },
                        {
                            name: "Frames",
                            children: [
                                { name: "Timber", description: "FSC certified" },
                                { name: "uPVC", description: "Recycled content" },
                                { name: "Aluminum", description: "Thermal breaks" }
                            ]
                        }
                    ]
                },
                {
                    name: "Insulation",
                    color: "#10b981",
                    description: "Thermal performance",
                    children: [
                        {
                            name: "Conventional",
                            children: [
                                { name: "Mineral wool", description: "Rock and glass" },
                                { name: "PIR/PUR", description: "Foam boards" },
                                { name: "XPS/EPS", description: "Polystyrene" }
                            ]
                        },
                        {
                            name: "Natural",
                            children: [
                                { name: "Wood fiber", description: "Recycled wood" },
                                { name: "Hemp", description: "Cannabis fiber" },
                                { name: "Cork", description: "Expanded bark" }
                            ]
                        }
                    ]
                },
                {
                    name: "Innovation",
                    color: "#ef4444",
                    description: "Emerging technologies",
                    children: [
                        {
                            name: "Near-term",
                            children: [
                                { name: "UHPC panels", description: "Ultra-high performance" },
                                { name: "3D printing", description: "Additive manufacturing" },
                                { name: "Biocomposites", description: "Scaling production" }
                            ]
                        },
                        {
                            name: "Carbon-negative",
                            children: [
                                { name: "CO2 concrete", description: "Mineralization tech" },
                                { name: "Algae panels", description: "Bioreactor facades" },
                                { name: "Living walls", description: "Vegetated systems" }
                            ]
                        }
                    ]
                },
                {
                    name: "Supply Chain",
                    color: "#8b5cf6",
                    description: "Sourcing and circular economy",
                    children: [
                        {
                            name: "Local Sourcing",
                            children: [
                                { name: "500km radius", description: "Primary zone" },
                                { name: "Material mapping", description: "Availability audit" }
                            ]
                        },
                        {
                            name: "Circular Economy",
                            children: [
                                { name: "Take-back", description: "Manufacturer agreements" },
                                { name: "Material passports", description: "Digital documentation" },
                                { name: "Disassembly", description: "Reversible connections" }
                            ]
                        }
                    ]
                },
                {
                    name: "Decision Criteria",
                    color: "#f59e0b",
                    description: "Evaluation frameworks",
                    children: [
                        {
                            name: "Trade-offs",
                            children: [
                                { name: "Performance vs carbon", description: "Technical balance" },
                                { name: "Cost vs CO2 saved", description: "‚Ç¨/tCO2 metric" },
                                { name: "Durability", description: "Lifespan optimization" }
                            ]
                        },
                        {
                            name: "Risk Assessment",
                            children: [
                                { name: "Tech maturity", description: "TRL levels" },
                                { name: "Warranties", description: "Insurance" },
                                { name: "Compliance", description: "Building codes" }
                            ]
                        }
                    ]
                }
            ]
        };

        // Global variables
        const svg = document.getElementById('mindmap');
        const tooltip = document.querySelector('.tooltip');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const searchResults = document.getElementById('searchResults');
        const zoomLevelDisplay = document.getElementById('zoomLevel');
        
        let currentTransform = { x: 0, y: 0, scale: 0.8 };
        let isDragging = false;
        let startX, startY;
        let searchQuery = '';
        let highlightedNodes = new Set();
        
        // SVG setup
        const width = window.innerWidth;
        const height = window.innerHeight - 100;
        svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
        
        // Create main group
        const mainGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        svg.appendChild(mainGroup);
        
        // Calculate positions with anti-overlap algorithm
        function calculateNodePositions(node, x = width/2, y = height/2, level = 0, angle = 0, angleRange = Math.PI * 2) {
            node.x = x;
            node.y = y;
            node.level = level;
            node.id = (node.name || '').replace(/[\s\/]+/g, '-').toLowerCase();
            
            if (node.children && !node.collapsed) {
                const childCount = node.children.length;
                const minAngle = Math.PI / 12;
                const requiredAngle = childCount * minAngle;
                const effectiveAngleRange = Math.max(angleRange, requiredAngle);
                
                let radius;
                if (level === 0) {
                    radius = Math.max(250, 180 + childCount * 12);
                } else if (level === 1) {
                    radius = Math.max(180, 120 + childCount * 8);
                } else {
                    radius = Math.max(120, 80 + childCount * 5);
                }
                
                const angleStep = effectiveAngleRange / childCount;
                const startAngle = angle - effectiveAngleRange / 2;
                
                node.children.forEach((child, i) => {
                    const childAngle = startAngle + angleStep * (i + 0.5);
                    const childX = x + Math.cos(childAngle) * radius;
                    const childY = y + Math.sin(childAngle) * radius;
                    const childAngleRange = level === 0 ? angleStep * 0.85 : angleStep * 0.65;
                    
                    calculateNodePositions(child, childX, childY, level + 1, childAngle, childAngleRange);
                });
            }
        }
        
        // Draw links
        function drawLinks(node, parentGroup) {
            if (node.children && !node.collapsed) {
                node.children.forEach(child => {
                    const link = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const mx = (node.x + child.x) / 2;
                    const my = (node.y + child.y) / 2;
                    
                    link.setAttribute('d', `M${node.x},${node.y} Q${mx},${my - 20} ${child.x},${child.y}`);
                    link.setAttribute('class', 'link');
                    link.setAttribute('stroke', node.color || '#cbd5e0');
                    link.setAttribute('stroke-width', Math.max(1, 3 - child.level));
                    link.setAttribute('data-source', node.id);
                    link.setAttribute('data-target', child.id);
                    
                    parentGroup.appendChild(link);
                    drawLinks(child, parentGroup);
                });
            }
        }
        
        // Draw nodes
        function drawNodes(node, parentGroup) {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('class', node.level === 0 ? 'node center-node' : 'node');
            g.setAttribute('transform', `translate(${node.x}, ${node.y})`);
            g.setAttribute('data-id', node.id);
            
            const radius = node.level === 0 ? 35 : Math.max(12, 25 - node.level * 3);
            const fontSize = node.level === 0 ? 12 : Math.max(8, 10 - node.level);
            
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('r', radius);
            circle.setAttribute('class', 'node-circle');
            circle.setAttribute('fill', node.color || '#e2e8f0');
            circle.setAttribute('stroke', '#fff');
            circle.setAttribute('stroke-width', '2');
            
            g.appendChild(circle);
            
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('class', 'node-text');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', node.level === 0 ? '#fff' : '#2d3748');
            text.setAttribute('font-size', fontSize);
            
            const lines = (node.name || '').split('\n');
            lines.forEach((line, i) => {
                const tspan = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                tspan.textContent = line;
                tspan.setAttribute('x', '0');
                tspan.setAttribute('dy', i === 0 ? -(lines.length - 1) * fontSize / 2 : fontSize);
                text.appendChild(tspan);
            });
            
            g.appendChild(text);
            
            // Events
            g.addEventListener('mouseenter', (e) => {
                if (node.description || node.children) {
                    tooltip.innerHTML = `<strong>${(node.name || '').replace(/\n/g, ' ')}</strong>`;
                    if (node.description) {
                        tooltip.innerHTML += `<br>${node.description}`;
                    }
                    tooltip.style.opacity = '1';
                }
            });
            
            g.addEventListener('mousemove', (e) => {
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY - 30 + 'px';
            });
            
            g.addEventListener('mouseleave', () => {
                tooltip.style.opacity = '0';
            });
            
            if (node.children) {
                g.addEventListener('click', (e) => {
                    e.stopPropagation();
                    node.collapsed = !node.collapsed;
                    draw();
                });
            }
            
            parentGroup.appendChild(g);
            
            if (node.children && !node.collapsed) {
                node.children.forEach(child => drawNodes(child, parentGroup));
            }
        }
        
        // Main draw function
        function draw() {
            mainGroup.innerHTML = '';
            calculateNodePositions(mindMapData);
            
            const linksGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            drawLinks(mindMapData, linksGroup);
            mainGroup.appendChild(linksGroup);
            
            const nodesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            drawNodes(mindMapData, nodesGroup);
            mainGroup.appendChild(nodesGroup);
        }
        
        // Transform functions
        function updateTransform() {
            mainGroup.setAttribute('transform', 
                `translate(${currentTransform.x}, ${currentTransform.y}) scale(${currentTransform.scale})`);
        }
        
        function updateZoomDisplay() {
            zoomLevelDisplay.textContent = Math.round(currentTransform.scale * 100) + '%';
        }
        
        // Control functions
        window.expandAll = function() {
            function expand(node) {
                node.collapsed = false;
                if (node.children) node.children.forEach(expand);
            }
            expand(mindMapData);
            draw();
        };
        
        window.collapseAll = function() {
            function collapse(node) {
                if (node.level > 0) node.collapsed = true;
                if (node.children) node.children.forEach(collapse);
            }
            collapse(mindMapData);
            draw();
        };
        
        window.resetView = function() {
            currentTransform = { x: 0, y: 0, scale: 0.8 };
            updateTransform();
            updateZoomDisplay();
        };
        
        window.zoomIn = function() {
            currentTransform.scale = Math.min(3, currentTransform.scale * 1.2);
            updateTransform();
            updateZoomDisplay();
        };
        
        window.zoomOut = function() {
            currentTransform.scale = Math.max(0.3, currentTransform.scale / 1.2);
            updateTransform();
            updateZoomDisplay();
        };
        
        window.exportData = function() {
            const format = confirm('Export as CSV? (OK for CSV, Cancel for Text)');
            
            function extractCSV(node, level = 0, path = '') {
                const rows = [];
                const currentPath = path ? path + ' > ' + node.name : node.name;
                rows.push([level, node.name, node.description || '', currentPath]);
                if (node.children) {
                    node.children.forEach(child => {
                        rows.push(...extractCSV(child, level + 1, currentPath));
                    });
                }
                return rows;
            }
            
            if (format) {
                const csvData = extractCSV(mindMapData);
                const csvContent = 'Level,Name,Description,Path\n' + 
                    csvData.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'facade-mindmap.csv';
                a.click();
                URL.revokeObjectURL(url);
            } else {
                function extractText(node, indent = '') {
                    let text = indent + '‚Ä¢ ' + node.name;
                    if (node.description) text += ' - ' + node.description;
                    text += '\n';
                    if (node.children) {
                        node.children.forEach(child => {
                            text += extractText(child, indent + '  ');
                        });
                    }
                    return text;
                }
                
                const textContent = 'Low-Carbon Facade Materials Research\n\n' + extractText(mindMapData);
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'facade-mindmap.txt';
                a.click();
                URL.revokeObjectURL(url);
            }
        };
        
        // Search functionality
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value;
            clearSearch.style.display = searchQuery ? 'flex' : 'none';
            
            if (searchQuery.length >= 2) {
                highlightSearch(searchQuery);
            } else {
                clearHighlight();
            }
        });
        
        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            searchQuery = '';
            clearSearch.style.display = 'none';
            clearHighlight();
        });
        
        function highlightSearch(query) {
            const lowerQuery = query.toLowerCase();
            const results = [];
            
            function searchNode(node, path = []) {
                const currentPath = [...path, node.name];
                if ((node.name || '').toLowerCase().includes(lowerQuery) || 
                    (node.description || '').toLowerCase().includes(lowerQuery)) {
                    results.push({ node, path: currentPath });
                }
                if (node.children) {
                    node.children.forEach(child => searchNode(child, currentPath));
                }
            }
            
            searchNode(mindMapData);
            
            if (results.length > 0) {
                let html = `<strong>${results.length} results:</strong><br>`;
                results.slice(0, 5).forEach(r => {
                    html += `<div style="margin: 5px 0;">${r.path.join(' > ')}</div>`;
                });
                searchResults.innerHTML = html;
                searchResults.classList.add('active');
                
                // Highlight nodes
                document.querySelectorAll('.node').forEach(n => {
                    const id = n.getAttribute('data-id');
                    const found = results.some(r => r.node.id === id);
                    if (found) {
                        n.classList.add('highlighted');
                        n.classList.remove('dimmed');
                    } else {
                        n.classList.add('dimmed');
                        n.classList.remove('highlighted');
                    }
                });
            } else {
                searchResults.innerHTML = '<strong>No results found</strong>';
                searchResults.classList.add('active');
            }
        }
        
        function clearHighlight() {
            searchResults.classList.remove('active');
            document.querySelectorAll('.node').forEach(n => {
                n.classList.remove('highlighted', 'dimmed');
            });
        }
        
        // Pan and zoom
        svg.addEventListener('mousedown', (e) => {
            if (e.target === svg || e.target.parentNode === mainGroup) {
                isDragging = true;
                svg.classList.add('grabbing');
                startX = e.clientX - currentTransform.x;
                startY = e.clientY - currentTransform.y;
            }
        });
        
        svg.addEventListener('mousemove', (e) => {
            if (isDragging) {
                currentTransform.x = e.clientX - startX;
                currentTransform.y = e.clientY - startY;
                updateTransform();
            }
        });
        
        svg.addEventListener('mouseup', () => {
            isDragging = false;
            svg.classList.remove('grabbing');
        });
        
        svg.addEventListener('mouseleave', () => {
            isDragging = false;
            svg.classList.remove('grabbing');
        });
        
        svg.addEventListener('wheel', (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = currentTransform.scale * delta;
            
            if (newScale >= 0.3 && newScale <= 3) {
                currentTransform.scale = newScale;
                updateTransform();
                updateZoomDisplay();
            }
        });
        
        // Initialize
        draw();
        updateTransform();
        updateZoomDisplay();
    </script>
</body>
</html>
